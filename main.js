(()=>{"use strict";function e(e,t){e.disabled=!0,e.classList.add(t.inactiveButtonClass)}function t(t,n,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(n.disabled=!1,n.classList.remove(o.inactiveButtonClass)):e(n,o)}var n=document.querySelector(".popup_content_remove-card-confirmation"),o=document.querySelector(".profile__avatar-wrapper"),r=document.querySelector(".profile__edit-icon");function c(e,t){e.classList.add("popup_opened"),document.addEventListener("keydown",W),n.className.includes("popup_opened")&&function(e){n.dataset.id=e}(t)}function u(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",W)}function a(e){e&&(document.querySelector(".popup_opened").querySelector(".popup__submit-button").textContent="Сохранение...")}o.addEventListener("mouseover",(function(){r.classList.add("profile__edit-icon_display_active")})),o.addEventListener("mouseout",(function(){r.classList.remove("profile__edit-icon_display_active")}));var i=document.querySelector(".elements__wrapper"),s=document.querySelector(".popup__form_card"),l=document.querySelector("#place-image-link-input"),d=document.querySelector("#place-name-input"),p=document.querySelector(".profile__add-new-button"),m=document.querySelector(".popup_content_new-card"),_=document.querySelector(".popup__close-button_content_new-card"),f=document.querySelector("#new-card-template").content,v=document.querySelector(".popup_content_remove-card-confirmation");function y(e,t,n,o,r,u){var a=function(e,t,n,o){var r=f.cloneNode(!0),u=r.querySelector(".element"),a=r.querySelector(".element__caption"),i=r.querySelector(".element__image"),s=r.querySelector(".element__like-button"),l=r.querySelector(".element__trash-bin-button"),d=r.querySelector(".element__like-counter");return u.dataset.cardId=o,i.src=e,i.alt=t,a.textContent=t,d.textContent=n,i.addEventListener("click",Q),s.addEventListener("click",S),l.addEventListener("click",(function(){c(v,o)})),r}(e,t,n,o);i.append(a),u&&function(e){document.querySelector('[data-card-id="'.concat(e,'"]')).querySelector(".element__like-button").classList.toggle("element__like-button_active")}(o),r||function(e){document.querySelector('[data-card-id="'.concat(e,'"]')).querySelector(".element__trash-bin-button").style.display="none"}(o)}function S(e){var t=e.target.closest(".element").dataset.cardId;console.log(e.target.classList),e.target.classList.contains("element__like-button_active")?(e.target.classList.remove("element__like-button_active"),function(e,t){fetch("".concat(q.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:q.headers}).then((function(e){return e.ok?e.json():Promise.reject("Пока снимали лайкк карточке ".concat(t," сервер вернул ошибку: ").concat(e.status))})).then((function(t){console.log(t),h(e,t.likes.length)}))}(e,t)):(e.target.classList.add("element__like-button_active"),function(e,t){fetch("".concat(q.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:q.headers}).then((function(e){return e.ok?e.json():Promise.reject("При отправке лайка карточке ".concat(t,": ").concat(e.status))})).then((function(t){console.log(t),h(e,t.likes.length)}))}(e,t))}function h(e,t){e.target.closest(".element__like-wrapper").querySelector(".element__like-counter").textContent=t}s.addEventListener("submit",(function(t){t.preventDefault(),a(!0);var n,o,r=l.value,c=d.value;y(r,c),e(t.submitter,{inactiveButtonClass:"popup__submit-button_inactive"}),n=c,o=r,fetch("".concat(q.baseUrl,"/cards"),{method:"POST",headers:q.headers,body:JSON.stringify({name:n,link:o})}).then((function(e){return e.ok?e.json():Promise.reject("При отправке новой карточки сервер вернул: ".concat(e.status))})),t.target.reset(),u(m)})),p.addEventListener("click",(function(){c(m)})),_.addEventListener("click",(function(){u(m)}));var q={baseUrl:"https://nomoreparties.co/v1/plus-cohort-18",headers:{authorization:"f14db4e9-636d-4f4a-a139-30505d4235b0","Content-Type":"application/json"}},b=document.querySelector(".profile__avatar"),k=document.querySelector(".profile__username"),L=document.querySelector(".profile__status"),g=document.querySelectorAll(".popup"),E=document.querySelector(".popup__close-button_content_fullimage"),C=document.querySelector(".popup_content_fullimage"),j=document.querySelector(".profile__username"),x=document.querySelector(".profile__status"),w=document.querySelector(".profile__editname-button"),P=document.querySelector(".popup_content_profile"),U=document.querySelector(".popup__close-button_content_profile"),A=document.querySelector(".popup__container_modal_confirmation"),T=document.querySelector(".popup_content_remove-card-confirmation"),B=A.querySelector(".popup__close-button"),D=document.querySelector(".popup__confirmation-button"),N=document.querySelector("#username-input"),O=document.querySelector("#status-input"),J=document.querySelector(".profile__avatar-wrapper"),M=document.querySelector(".profile__avatar"),H=document.forms.profileForm,I=document.forms.newAvatarLink,V=document.querySelector(".popup__caption"),z=document.querySelector(".popup__image"),F=document.querySelector(".popup_content_update-profile-image"),G=document.querySelector(".popup__close-button_content_profile-image"),K=document.querySelector("#avatar-image-link-input");function Q(e){var t=e.target.src;V.textContent=e.target.alt,z.src=t,z.alt=e.target.alt,c(C)}function R(e){e.target.closest(".popup__container")||u(e.target)}function W(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");null!==t&&u(t)}}B.addEventListener("click",(function(){u(document.querySelector(".popup_opened"))})),D.addEventListener("click",(function(){var e=T.closest(".popup_content_remove-card-confirmation").dataset.id,t=document.querySelector(".popup_opened");!function(e){var t=document.querySelector('[data-card-id="'.concat(e,'"]'));console.log(t),t.remove()}(e),function(e){fetch("".concat(q.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:q.headers}).then((function(t){return t.ok?t.json():Promise.reject("При удалении карточки ".concat(e," сервер вернул: ").concat(t.status))}))}(e),u(t)})),J.addEventListener("click",(function(){return c(F)})),E.addEventListener("click",(function(){u(C)})),w.addEventListener("click",(function(){N.value=j.textContent,O.value=x.textContent,c(P)})),U.addEventListener("click",(function(){return u(P)})),G.addEventListener("click",(function(){return u(F)})),H.addEventListener("submit",(function(e){e.preventDefault(),a(!0),function(e,t){fetch("".concat(q.baseUrl,"/users/me"),{method:"PATCH",headers:q.headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return e.ok?e.json():Promise.reject("При отправке данных пользователя сервер вернул: ".concat(e.status))}))}(N.value,O.value),j.textContent=N.value,x.textContent=O.value,u(P)})),I.addEventListener("submit",(function(e){var t;e.preventDefault(),a(!0),M.src=K.value,t=K.value,fetch("".concat(q.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:q.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("При отправке ссылки на новый аватар сервер вернул: ".concat(e.status))})),u(F)})),fetch("".concat(q.baseUrl,"/users/me"),{headers:q.headers}).then((function(e){return e.ok?e.json():Promise.reject("При получении данных профиля сервер вернул: ".concat(e.status))})).then((function(e){k.textContent=e.name,L.textContent=e.about,b.src=e.avatar})).catch((function(e){console.log(e)})),fetch("".concat(q.baseUrl,"/cards"),{headers:q.headers}).then((function(e){return e.ok?e.json():Promise.reject("При получении массива карточек сервер вернул: ".concat(e.status))})).then((function(e){e.forEach((function(e){var t,n,o=e.link,r=e.name,c=e.likes.length,u=e._id,a=function(e,t){return e.owner.name===t}(e,k.textContent);y(o,r,c,u,a,(t=e.likes,n=k.textContent,t.some((function(e){return e.name===n}))))}))})).catch((function(e){console.log(e)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(n){!function(e,n){var o=Array.from(e.querySelectorAll(n.inputSelector)),r=e.querySelector(n.submitButtonSelector);t(o,r,n),o.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.classList.add(o.errorClass),r.textContent=n}(e,t,t.validationMessage,n)}(e,c,n),t(o,r,n)}))}))}(n,e)}))}({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"}),g.forEach((function(e){e.addEventListener("mousedown",R)}))})();